<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL PickEm 2025/2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            text-align: center;
            padding: 2rem 0;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .login-container {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 400px;
            margin: 0 auto;
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: #1e3c72;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }

        .form-group select:focus {
            outline: none;
            border-color: #2a5298;
        }

        .btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .main-content {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 2rem;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid #eee;
        }

        .tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: #2a5298;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #2a5298;
        }

        .stat-card h3 {
            color: #2a5298;
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #1e3c72;
        }

        .team-usage {
            margin-top: 2rem;
        }

        .team-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .team-badge {
            background: #e9ecef;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .team-badge.winner {
            background: #d4edda;
            color: #155724;
        }

        .team-badge.loser {
            background: #f8d7da;
            color: #721c24;
        }

        .picks-container {
            margin-bottom: 2rem;
        }

        .week-selector {
            margin-bottom: 1.5rem;
        }

        .week-selector select {
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .matches-grid {
            display: grid;
            gap: 1rem;
        }

        .match-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            border: 2px solid #eee;
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .team {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .team img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .vs {
            font-weight: bold;
            color: #666;
            margin: 0 1rem;
        }

        .team-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .team-btn:hover {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
        }

        .team-btn.selected {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .team-btn:disabled {
            background: #6c757d;
            color: white;
            border-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .game-time {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .leaderboard-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2a5298;
        }

        .leaderboard-table tr:hover {
            background: #f8f9fa;
        }

        .rank-badge {
            background: #2a5298;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 50%;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
            display: inline-block;
        }

        .rank-badge.gold {
            background: #ffd700;
            color: #333;
        }

        .rank-badge.silver {
            background: #c0c0c0;
            color: #333;
        }

        .rank-badge.bronze {
            background: #cd7f32;
            color: white;
        }

        .rules-content {
            line-height: 1.8;
        }

        .rules-content h3 {
            color: #2a5298;
            margin: 1.5rem 0 0.5rem 0;
        }

        .rules-content ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .picks-history {
            margin-top: 2rem;
        }

        .user-picks {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .user-picks h4 {
            color: #2a5298;
            margin-bottom: 1rem;
        }

        .pick-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .pick-item:last-child {
            border-bottom: none;
        }

        .pick-result {
            font-weight: bold;
        }

        .pick-result.correct {
            color: #28a745;
        }

        .pick-result.incorrect {
            color: #dc3545;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            text-align: center;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            text-align: center;
        }

        .admin-panel {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-panel h3 {
            color: #856404;
            margin-bottom: 1rem;
        }

        .admin-form {
            display: grid;
            gap: 1rem;
        }

        .admin-form select,
        .admin-form input {
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .admin-btn {
            background: #856404;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }

        .admin-btn:hover {
            background: #6c5200;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .match-teams {
                flex-direction: column;
                gap: 1rem;
            }

            .vs {
                margin: 0;
            }

            .tabs {
                flex-direction: column;
            }

            .user-info {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèà NFL PickEm 2025/2026</h1>
        <p>W√§hle jede Woche ein Team, das gewinnen wird!</p>
    </div>

    <div class="container">
        {% if not logged_in %}
        <div class="login-container">
            <h2>Anmelden</h2>
            <div class="form-group">
                <label for="userSelect">W√§hle deinen Namen:</label>
                <select id="userSelect" onchange="selectUser()">
                    <option value="">-- Bitte w√§hlen --</option>
                    <option value="Manuel">Manuel</option>
                    <option value="Daniel">Daniel</option>
                    <option value="Raff">Raff</option>
                    <option value="Haunschi">Haunschi</option>
                </select>
            </div>
        </div>
        {% else %}
        <div class="main-content">
            <div class="user-info">
                <h3>Willkommen, {{ username }}!</h3>
                <button class="logout-btn" onclick="logout()">Abmelden</button>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
                <button class="tab" onclick="showTab('picks')">üéØ Picks</button>
                <button class="tab" onclick="showTab('leaderboard')">üèÜ Leaderboard</button>
                <button class="tab" onclick="showTab('rules')">üìã Spielregeln</button>
                <button class="tab" onclick="showTab('all-picks')">üìà Picks aller Spieler</button>
                {% if is_admin %}
                <button class="tab" onclick="showTab('admin-panel')">üîß Admin</button>
                {% endif %}
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Aktuelle Woche</h3>
                        <div class="value" id="currentWeek">-</div>
                        <small>Woche</small>
                    </div>
                    <div class="stat-card">
                        <h3>Gesamtpunkte</h3>
                        <div class="value" id="totalPoints">-</div>
                        <small>Punkte</small>
                    </div>
                    <div class="stat-card">
                        <h3>Richtige Picks</h3>
                        <div class="value" id="correctPicks">-</div>
                        <small>Erfolgsquote</small>
                    </div>
                    <div class="stat-card">
                        <h3>Aktueller Rang</h3>
                        <div class="value" id="currentRank">-</div>
                        <small>Platz</small>
                    </div>
                </div>

                <div class="team-usage">
                    <h3>Team Usage</h3>
                    <div>
                        <h4>Als Gewinner verwendet:</h4>
                        <div class="team-list" id="winnersUsed">
                            <span class="team-badge">Keine Teams verwendet</span>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <h4>Als Verlierer verwendet:</h4>
                        <div class="team-list" id="losersUsed">
                            <span class="team-badge">Keine Teams eliminiert</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Picks Tab -->
            <div id="picks" class="tab-content">
                <h2>Picks</h2>
                <div class="picks-container">
                    <div class="week-selector">
                        <label for="weekSelect">Woche ausw√§hlen:</label>
                        <select id="weekSelect" onchange="loadMatches()">
                            <option value="1">Woche 1 ‚úÖ</option>
                            <option value="2">Woche 2 ‚úÖ</option>
                            <option value="3" selected>Woche 3 üîÑ</option>
                            <option value="4">Woche 4 üîÑ</option>
                            <option value="5">Woche 5 üîÑ</option>
                            <option value="6">Woche 6 üîÑ</option>
                            <option value="7">Woche 7 üîÑ</option>
                            <option value="8">Woche 8 üîÑ</option>
                            <option value="9">Woche 9 üîÑ</option>
                            <option value="10">Woche 10 üîÑ</option>
                            <option value="11">Woche 11 üîÑ</option>
                            <option value="12">Woche 12 üîÑ</option>
                            <option value="13">Woche 13 üîÑ</option>
                            <option value="14">Woche 14 üîÑ</option>
                            <option value="15">Woche 15 üîÑ</option>
                            <option value="16">Woche 16 üîÑ</option>
                            <option value="17">Woche 17 üîÑ</option>
                            <option value="18">Woche 18 üîÑ</option>
                        </select>
                    </div>
                    <div id="matchesContainer">
                        <div class="error-message">Lade Spiele...</div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Tab -->
            <div id="leaderboard" class="tab-content">
                <h2>Leaderboard</h2>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rang</th>
                            <th>Spieler</th>
                            <th>Punkte</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr>
                            <td colspan="3" style="text-align: center;">Lade Leaderboard...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Rules Tab -->
            <div id="rules" class="tab-content">
                <h2>Spielregeln</h2>
                <div class="rules-content">
                    <p><strong>NFL PickEm 2025/2026 - Regeln</strong> üèà</p>
                    
                    <h3><strong>W√∂chentliche Picks:</strong></h3>
                    <p>W√§hle jede Woche ein Team, welches deiner Meinung nach gewinnt. üßê</p>
                    
                    <h3><strong>Punkte:</strong></h3>
                    <p>F√ºr jeden richtigen Pick erh√§ltst du 1 Punkt. ü§ë<br>
                    (Falsche Picks oder Unentschieden bringen keine Punkte) ‚ò†Ô∏è</p>
                    
                    <h3><strong>Team-Limits:</strong> üß†</h3>
                    <ul>
                        <li>Jedes Team kann maximal 2x pro Saison als Gewinner ausgew√§hlt werden.</li>
                        <li>Jedes Team kann maximal 1x pro Saison als Verlierer ausgew√§hlt werden.</li>
                    </ul>
                    
                    <h3><strong>Deadline:</strong> ‚ö†Ô∏è</h3>
                    <p>Picks m√ºssen vor jeweiligem Spielbeginn abgegeben werden.</p>
                    
                    <h3><strong>Saison:</strong> üèÅ</h3>
                    <p>Die Saison l√§uft √ºber 18 Wochen der NFL Regular Season.</p>
                    
                    <h3><strong>Gewinner:</strong> ü•á</h3>
                    <p>Der Spieler mit den meisten Punkten am Ende der Saison gewinnt.</p>
                    
                    <h3><strong>Preis:</strong> üç∫</h3>
                    <p>Aller Verlierer lassen eine Kiste Bier springen. üç∫üç∫</p>
                </div>
            </div>

            <!-- All Picks Tab -->
            <div id="all-picks" class="tab-content">
                <h2>üìä Picks aller Spieler</h2>
                <div id="allPicksContainer">
                    <div class="error-message">Lade Picks...</div>
                </div>
            </div>

            <!-- Admin Panel Tab -->
            {% if is_admin %}
            <div id="admin-panel" class="tab-content">
                <div class="admin-panel">
                    <h3>üîß Admin Panel</h3>
                    <p>Spielergebnisse setzen und automatisch validieren</p>
                    
                    <div class="admin-form">
                        <div>
                            <label for="gameSelect">Spiel ausw√§hlen:</label>
                            <select id="gameSelect">
                                <option value="">Lade Spiele...</option>
                            </select>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label for="awayScore">Ausw√§rts Punkte:</label>
                                <input type="number" id="awayScore" min="0" placeholder="0">
                            </div>
                            <div>
                                <label for="homeScore">Heim Punkte:</label>
                                <input type="number" id="homeScore" min="0" placeholder="0">
                            </div>
                        </div>
                        
                        <button class="admin-btn" onclick="setGameResult()">
                            Ergebnis setzen & Automatisch validieren
                        </button>
                    </div>
                    
                    <div id="adminMessage"></div>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <script>
        let currentUser = {% if logged_in %}'{{ username }}'{% else %}null{% endif %};
        let isAdmin = {% if logged_in and is_admin %}true{% else %}false{% endif %};

        // Simple user selection (no login process)
        function selectUser() {
            const select = document.getElementById('userSelect');
            const username = select.value;
            
            if (username) {
                fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username: username })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Fehler beim Anmelden: ' + (data.error || 'Unbekannter Fehler'));
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    alert('Fehler beim Anmelden');
                });
            }
        }

        function logout() {
            fetch('/api/logout', { method: 'POST' })
                .then(() => location.reload())
                .catch(error => console.error('Logout error:', error));
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data for specific tabs
            if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'picks') {
                loadMatches();
            } else if (tabName === 'leaderboard') {
                loadLeaderboard();
            } else if (tabName === 'all-picks') {
                loadAllPicks();
            } else if (tabName === 'admin-panel' && isAdmin) {
                loadPendingGames();
            }
        }

        function loadDashboard() {
            fetch('/api/dashboard')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Dashboard error:', data.error);
                        return;
                    }

                    document.getElementById('currentWeek').textContent = data.current_week || '-';
                    document.getElementById('totalPoints').textContent = data.total_points || '0';
                    document.getElementById('correctPicks').textContent = data.correct_picks || '0/0';
                    document.getElementById('currentRank').textContent = data.current_rank || '-';

                    // Update team usage
                    const winnersContainer = document.getElementById('winnersUsed');
                    const losersContainer = document.getElementById('losersUsed');

                    if (data.winners_used && data.winners_used.length > 0) {
                        winnersContainer.innerHTML = data.winners_used.map(team => 
                            `<span class="team-badge winner">${team}</span>`
                        ).join('');
                    } else {
                        winnersContainer.innerHTML = '<span class="team-badge">Keine Teams verwendet</span>';
                    }

                    if (data.losers_used && data.losers_used.length > 0) {
                        losersContainer.innerHTML = data.losers_used.map(team => 
                            `<span class="team-badge loser">${team}</span>`
                        ).join('');
                    } else {
                        losersContainer.innerHTML = '<span class="team-badge">Keine Teams eliminiert</span>';
                    }
                })
                .catch(error => {
                    console.error('Dashboard load error:', error);
                });
        }

        function loadMatches() {
            const week = document.getElementById('weekSelect').value;
            const container = document.getElementById('matchesContainer');
            
            container.innerHTML = '<div class="error-message">Lade Spiele...</div>';

            fetch(`/api/matches/${week}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        container.innerHTML = `<div class="error-message">Fehler beim Laden der Spiele: ${data.error}</div>`;
                        return;
                    }

                    if (!data.matches || data.matches.length === 0) {
                        container.innerHTML = '<div class="error-message">Keine Spiele f√ºr diese Woche gefunden</div>';
                        return;
                    }

                    const matchesHTML = data.matches.map(match => `
                        <div class="match-card">
                            <div class="match-teams">
                                <div class="team">
                                    <button class="team-btn ${!match.away_team.pickable ? 'disabled' : ''}" 
                                            onclick="selectTeam(${match.id}, ${match.away_team.id})"
                                            ${!match.away_team.pickable ? 'disabled title="' + match.away_team.reason + '"' : ''}>
                                        <img src="${match.away_team.logo}" alt="${match.away_team.name}" onerror="this.style.display='none'">
                                        ${match.away_team.name}
                                    </button>
                                </div>
                                <div class="vs">@</div>
                                <div class="team">
                                    <button class="team-btn ${!match.home_team.pickable ? 'disabled' : ''}" 
                                            onclick="selectTeam(${match.id}, ${match.home_team.id})"
                                            ${!match.home_team.pickable ? 'disabled title="' + match.home_team.reason + '"' : ''}>
                                        <img src="${match.home_team.logo}" alt="${match.home_team.name}" onerror="this.style.display='none'">
                                        ${match.home_team.name}
                                    </button>
                                </div>
                            </div>
                            <div class="game-time">${match.game_time}</div>
                        </div>
                    `).join('');

                    container.innerHTML = matchesHTML;
                })
                .catch(error => {
                    console.error('Matches load error:', error);
                    container.innerHTML = '<div class="error-message">Fehler beim Laden der Spiele</div>';
                });
        }

        function selectTeam(matchId, teamId) {
            // Implementation for team selection
            console.log('Selected team:', teamId, 'for match:', matchId);
        }

        function loadLeaderboard() {
            fetch('/api/leaderboard')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('leaderboardBody');
                    
                    if (data.error || !data.leaderboard) {
                        tbody.innerHTML = '<tr><td colspan="3" style="text-align: center;">Fehler beim Laden des Leaderboards</td></tr>';
                        return;
                    }

                    const leaderboardHTML = data.leaderboard.map(player => {
                        let rankClass = '';
                        if (player.rank === 1) rankClass = 'gold';
                        else if (player.rank === 2) rankClass = 'silver';
                        else if (player.rank === 3) rankClass = 'bronze';

                        return `
                            <tr>
                                <td><span class="rank-badge ${rankClass}">${player.rank}</span></td>
                                <td>${player.username}</td>
                                <td>${player.points}</td>
                            </tr>
                        `;
                    }).join('');

                    tbody.innerHTML = leaderboardHTML;
                })
                .catch(error => {
                    console.error('Leaderboard load error:', error);
                    document.getElementById('leaderboardBody').innerHTML = 
                        '<tr><td colspan="3" style="text-align: center;">Fehler beim Laden des Leaderboards</td></tr>';
                });
        }

        function loadAllPicks() {
            fetch('/api/all-picks')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('allPicksContainer');
                    
                    if (data.error || !data.picks) {
                        container.innerHTML = '<div class="error-message">Fehler beim Laden der Picks</div>';
                        return;
                    }

                    const picksHTML = Object.entries(data.picks).map(([username, picks]) => `
                        <div class="user-picks">
                            <h4>${username}</h4>
                            ${picks.map(pick => `
                                <div class="pick-item">
                                    <span>Woche ${pick.week}: ${pick.team}</span>
                                    <span class="pick-result ${pick.correct ? 'correct' : 'incorrect'}">
                                        ${pick.correct ? '‚úÖ' : '‚ùå'}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    `).join('');

                    container.innerHTML = picksHTML;
                })
                .catch(error => {
                    console.error('All picks load error:', error);
                    document.getElementById('allPicksContainer').innerHTML = 
                        '<div class="error-message">Fehler beim Laden der Picks</div>';
                });
        }

        function loadPendingGames() {
            if (!isAdmin) return;

            fetch('/api/pending-games')
                .then(response => response.json())
                .then(data => {
                    const select = document.getElementById('gameSelect');
                    
                    if (data.error || !data.games) {
                        select.innerHTML = '<option value="">Fehler beim Laden der Spiele</option>';
                        return;
                    }

                    const gamesHTML = data.games.map(game => 
                        `<option value="${game.id}">${game.description}</option>`
                    ).join('');

                    select.innerHTML = '<option value="">-- Spiel ausw√§hlen --</option>' + gamesHTML;
                })
                .catch(error => {
                    console.error('Pending games load error:', error);
                    document.getElementById('gameSelect').innerHTML = 
                        '<option value="">Fehler beim Laden der Spiele</option>';
                });
        }

        function setGameResult() {
            if (!isAdmin) return;

            const matchId = document.getElementById('gameSelect').value;
            const awayScore = document.getElementById('awayScore').value;
            const homeScore = document.getElementById('homeScore').value;

            if (!matchId || awayScore === '' || homeScore === '') {
                alert('Bitte alle Felder ausf√ºllen');
                return;
            }

            fetch('/api/set-game-result', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    match_id: parseInt(matchId),
                    away_score: parseInt(awayScore),
                    home_score: parseInt(homeScore)
                })
            })
            .then(response => response.json())
            .then(data => {
                const messageDiv = document.getElementById('adminMessage');
                
                if (data.success) {
                    messageDiv.innerHTML = `<div class="success-message">${data.message}</div>`;
                    // Reset form
                    document.getElementById('gameSelect').value = '';
                    document.getElementById('awayScore').value = '';
                    document.getElementById('homeScore').value = '';
                    // Reload pending games
                    loadPendingGames();
                } else {
                    messageDiv.innerHTML = `<div class="error-message">Fehler: ${data.error}</div>`;
                }
            })
            .catch(error => {
                console.error('Set game result error:', error);
                document.getElementById('adminMessage').innerHTML = 
                    '<div class="error-message">Fehler beim Setzen des Ergebnisses</div>';
            });
        }

        // Initialize dashboard on page load
        if (currentUser) {
            loadDashboard();
        }
    </script>
</body>
</html>